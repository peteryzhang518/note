pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #02 pc 000000000004e63c  /apex/com.android.runtime/lib64/bionic/libc.so (memcpy_opt+252)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #03 pc 0000000000a006a8  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPass::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+168)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #04 pc 0000000000a0a2ec  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPassDSScale::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+1740)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #05 pc 00000000009cab20  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::SetupDeviceResource(CSLBufferInfo*, CSLDeviceResource*)+20096)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #06 pc 000000000095f5f4  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::PostPipelineCreate()+28500)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #07 pc 00000000017e271c  /vendor/lib64/hw/camera.qcom.so (CamX::CNodeImpl::DeferPipelineCreate(void*) (.cfi)+140)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #08 pc 00000000000ba650  /apex/com.android.runtime/lib64/bionic/libc.so (__pthread_start(void*)+208)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : #09 pc 0000000000053ffc  /apex/com.android.runtime/lib64/bionic/libc.so (__start_thread+68)
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : pid: 18529, tid: 19000
pzlog.txt:01-02 13:06:25:474435725  18529  19000 F DEBUG   : signal 11, code 1, fault addr 0x0
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #02 pc 000000000004e63c  /apex/com.android.runtime/lib64/bionic/libc.so (memcpy_opt+252)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #03 pc 0000000000a006a8  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPass::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+168)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #04 pc 0000000000a0a2ec  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPassDSScale::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+1740)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #05 pc 00000000009cab20  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::SetupDeviceResource(CSLBufferInfo*, CSLDeviceResource*)+20096)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #06 pc 000000000095f5f4  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::PostPipelineCreate()+28500)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #07 pc 00000000017e271c  /vendor/lib64/hw/camera.qcom.so (CamX::CNodeImpl::DeferPipelineCreate(void*) (.cfi)+140)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #08 pc 00000000000ba650  /apex/com.android.runtime/lib64/bionic/libc.so (__pthread_start(void*)+208)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : #09 pc 0000000000053ffc  /apex/com.android.runtime/lib64/bionic/libc.so (__start_thread+68)
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : pid: 18529, tid: 18999
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : signal 11, code 1, fault addr 0x0
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #02 pc 000000000004e63c  /apex/com.android.runtime/lib64/bionic/libc.so (memcpy_opt+252)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #03 pc 0000000000a006a8  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPass::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+168)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #04 pc 0000000000a0a2ec  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPassDSScale::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+1740)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #05 pc 00000000009cab20  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::SetupDeviceResource(CSLBufferInfo*, CSLDeviceResource*)+20096)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #06 pc 000000000095f5f4  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::PostPipelineCreate()+28500)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #07 pc 00000000017e271c  /vendor/lib64/hw/camera.qcom.so (CamX::CNodeImpl::DeferPipelineCreate(void*) (.cfi)+140)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #08 pc 00000000000ba650  /apex/com.android.runtime/lib64/bionic/libc.so (__pthread_start(void*)+208)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #09 pc 0000000000053ffc  /apex/com.android.runtime/lib64/bionic/libc.so (__start_thread+68)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : pid: 18529, tid: 18998
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : signal 11, code 1, fault addr 0x0
这个进程的工作没有很多，所以不知道干啥的



查进程log
有三个version
第三个version没有打印出来

把第二个ersion到f debug的log都打印出来
发现疑似log



56926:01-02 13:06:25:834353745  18529  18996 E CHIUSECASE: [ERROR  ] chifeature2base.cpp:15945 ActivatePipeline() MultiCameraReprocessRealtime Activate MultiCameraSATWithBoe0 failed! result: CDKResultEFailed
56927:01-02 13:06:25:834400829  18529  18996 E CHIUSECASE: [ERROR  ] chifeature2base.cpp:1937 SubmitRequestToSession() FRO-URO:5_MCXSuperFG:MultiCameraReprocessRealtime_0 Submit request: 5 failure for session:MCReprocRT
56928:01-02 13:06:25:834441870  18529  18996 E CHIUSECASE: [ERROR  ] chifeature2baserequestflow.cpp:139 ExecuteFlowType0() Failed to submit request 0 to session 1

所以联想到了streamon




pzlog.txt1:01-02 13:06:25:832626870  18529  18996 E CamX: [ERROR][CORE   ] camxsession.cpp:3464 StreamOn() Session StreamOn() is failed with CamxResultEFailed!! Triggering System Event
pzlog.txt1:01-02 13:06:25:854777079  18529  18996 I CamX: [ INFO][CORE   ] camxsession.cpp:3428 StreamOn() FinalizePipeline result: 1 pipelineStatus: 3
pzlog.txt1:01-02 13:06:25:854813693  18529  18996 E CamX: [ERROR][CORE   ] camxsession.cpp:3434 StreamOn() FinalizePipeline() unsuccessful, Session StreamOn() is failed with CamxResultEFailed!!
pzlog.txt1:01-02 13:06:25:854825985  18529  18996 E CamX: [ERROR][CORE   ] camxsession.cpp:3464 StreamOn() Session StreamOn() is failed with CamxResultEFailed!! Triggering System Event



看了下确实有log，判断是出错之前还是之后


pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : pid: 18529, tid: 18999
pzlog.txt:01-02 13:06:25:475468954  18529  18999 F DEBUG   : signal 11, code 1, fault addr 0x0
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #02 pc 000000000004e63c  /apex/com.android.runtime/lib64/bionic/libc.so (memcpy_opt+252)
pzlog.txt:02-02 13:06:25:504075725  18529  18998 F DEBUG   : #03 pc 0000000000a006a8  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPass::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+168)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #04 pc 0000000000a0a2ec  /vendor/lib64/hw/camera.qcom.so (CamX::IPEGenericPassDSScale::ConfigIODataPrepare(CamX::GenericPassLinkageData&, std::__1::unordered_map<unsigned int, CamX::ImageFormat const*, std::__1::hash<unsigned int>, std::__1::equal_to<unsigned int>, std::__1::allocator<std::__1::pair<unsigned int const, CamX::ImageFormat const*> > >&)+1740)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #05 pc 00000000009cab20  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::SetupDeviceResource(CSLBufferInfo*, CSLDeviceResource*)+20096)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #06 pc 000000000095f5f4  /vendor/lib64/hw/camera.qcom.so (CamX::IPENode::PostPipelineCreate()+28500)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #07 pc 00000000017e271c  /vendor/lib64/hw/camera.qcom.so (CamX::CNodeImpl::DeferPipelineCreate(void*) (.cfi)+140)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #08 pc 00000000000ba650  /apex/com.android.runtime/lib64/bionic/libc.so (__pthread_start(void*)+208)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : #09 pc 0000000000053ffc  /apex/com.android.runtime/lib64/bionic/libc.so (__start_thread+68)
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : pid: 18529, tid: 18998
pzlog.txt:01-02 13:06:25:504075725  18529  18998 F DEBUG   : signal 11, code 1, fault addr 0x0
pzlog.txt:01-02 13:06:25:765354943  18529  18996 I CamX: [ INFO][CORE   ] camxsession.cpp:3428 StreamOn() FinalizePipeline result: 1 pipelineStatus: 3
pzlog.txt:01-02 13:06:25:765371454  18529  18996 E CamX: [ERROR][CORE   ] camxsession.cpp:3434 StreamOn() FinalizePipeline() unsuccessful, Session StreamOn() is failed with CamxResultEFailed!!
pzlog.txt:01-02 13:06:25:765388068  18529  18996 E CamX: [ERROR][CORE   ] camxsession.cpp:3464 StreamOn() Session StreamOn() is failed with CamxResultEFailed!! Triggering System Event
pzlog.txt:01-02 13:06:25:769986506  18529  18996 I CamX: [ INFO][CORE   ] camxsession.cpp:3428 StreamOn() FinalizePipeline result: 1 pipelineStatus: 3
pzlog.txt:01-02 13:06:25:770002183  18529  18996 E CamX: [ERROR][CORE   ] camxsession.cpp:3434 StreamOn() FinalizePipeline() unsuccessful, Session StreamOn() is failed with CamxResultEFailed!!




看代码确实是streamon 的时候为每个pipeline起了个线程去作这件事
所有有三个这个报错
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
CamxResult Session::FinalizePipeline(
    UINT32 pipelineIndex)
{
    CamxResult result = CamxResultSuccess;
    CAMX_ENTRY(CamxLogGroupCore);
    CAMX_ASSERT(pipelineIndex < m_numPipelines);

    m_requestBatchId[pipelineIndex]       = CamxInvalidRequestId;

    if ((PipelineStatus::PRE_FINALIZATION_INPROGRESS == m_pipelineData[pipelineIndex].pPipeline->GetPipelineStatus() ||
        (PipelineStatus::PRE_FINALIZED == m_pipelineData[pipelineIndex].pPipeline->GetPipelineStatus())))
    {
        result = m_pipelineData[pipelineIndex].pPipeline->WaitForDeferPrepareFinalizePipeline();
    }
    else if (PipelineStatus::BUFFER_PROPERTIES_FINALIZED == m_pipelineData[pipelineIndex].pPipeline->GetPipelineStatus())
    {
        result = m_pipelineData[pipelineIndex].pPipeline->NotifyPrepareFinalizePipeline();

        if (CamxResultSuccess == result)
        {
            result = m_pipelineData[pipelineIndex].pPipeline->WaitForDeferPrepareFinalizePipeline();
        }

正好对应了上面三个线程crash
代码里面是wait线程 WaitForDeferPrepareFinalizePipeline 

那就在代码里尝试搜索DeferPrepareFinalizePipeline 
真有，那就去log里搜索这个函数报什么错导致没有wait到
01-02 13:06:25:478013485  18529  18997 E CamX: [ERROR][CORE   ] camxpipeline.cpp:3340 PrepareFinalizePipeline() Pipeline[MultiCameraSATWithBoe0_0_cam_1] Failed to initialize MultiCameraSATWithBoe0_com.qti.node.gme1_cam1: , result: CamxResultEFailed 1
01-02 13:06:25:478034371  18529  18997 E CamX: [ERROR][CORE   ] camxpipeline.cpp:3434 PrepareFinalizePipeline() Pipeline::MultiCameraSATWithBoe0_0_cam_1 PrepareFinalizePipeline failed with CamxResultEFailed
01-02 13:06:25:478053329  18529  18997 E CamX: [ERROR][CORE   ] camxpipeline.cpp:3560 DeferPrepareFinalizePipeline() Pipeline::MultiCameraSATWithBoe0_0_cam_1 : Failed to PrepareFinalizePipeline with error CamxResultEFailed



看到是gme问题
搜索gme log
38187:01-02 13:06:25:466619891  18529  18997 I CHIUSECASE: [INFO   ] camxchinodegme.cpp:1427 InitializeLib() MultiCameraSATWithBoe0_com.qti.node.gme1_cam1 Sensor id 2, sensor dim [4000 3000] frame dim [0 0 4000 3000], crop info [0 0 3999 2999], binning H 1 V 1 applied sensor crop [4000.000000 3000.000000 0.000000 0.000000 4000.000000 3000.000000]
38392:01-02 14:06:25:469691662  18529  18997 E CHIUSECASE: [ERROR  ] camxchinodegme.cpp:1463 InitializeLib() MultiCameraSATWithBoe0_com.qti.node.gme1_cam1 Algorithm Init Failed for exposure type: 0
39039:01-02 13:06:25:477931037  18529  18997 E CHIUSECASE: [ERROR  ] camxchinodegme.cpp:8425 OpenLib() MultiCameraSATWithBoe0_com.qti.node.gme1_cam1 couldn't get m_phEIS3Handle
39043:01-02 13:06:25:477989943  18529  18997 E CHIUSECASE: [ERROR  ] camxchinodegme.cpp:584 GMENodePostPipelineCreate() Failed in PostPipelineCreate, result=1



顺着这三个函数
发现一开始就是
CDKResult ChiGMENode::PostPipelineCreate()
{
    CDKResult result = OpenLib();

    m_bIsStreamCropPSM = IsStreamCropEnabled();

    for (uint32_t expIndex = 0; expIndex < m_numMFHDRExposure; ++expIndex)


    然后正好回到了一开始的crash报错，那就证明方向正确，gme没有找到eis handle
